<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Departments (Akhila) • HRMS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>

  <style>
    :root {
      --bg-primary:#0a0e1a; --bg-secondary:#111827; --bg-card:#1a1f35;
      --bg-hover:#252b45; --accent-cyan:#00d9ff; --accent-blue:#3b82f6;
      --text-primary:#e6f1fb; --text-secondary:#94a3b8; --text-muted:#64748b;
      --border-color:#1e293b; --border-accent:rgba(0,217,255,.3);
    }
    *{margin:0;padding:0;box-sizing:border-box}
    html,body{height:100%;font-family:Inter,'Segoe UI',system-ui,sans-serif;background:var(--bg-primary);color:var(--text-primary)}
    .page-wrapper{min-height:100vh;display:flex;flex-direction:column}

    /* Topbar */
    .topbar{position:sticky;top:0;z-index:100;background:linear-gradient(180deg,rgba(10,14,26,.98),rgba(17,24,39,.95));border-bottom:1px solid var(--border-color);backdrop-filter:blur(12px);box-shadow:0 4px 12px rgba(0,0,0,.3)}
    .topbar-inner{max-width:1200px;margin:0 auto;padding:16px 24px;display:flex;justify-content:space-between;align-items:center;gap:24px}
    .brand{display:flex;align-items:center;gap:12px;font-weight:700;font-size:18px;color:var(--accent-cyan);text-decoration:none}
    .brand-dot{width:10px;height:10px;border-radius:50%;background:radial-gradient(circle at 30% 30%,#fff,var(--accent-cyan));box-shadow:0 0 16px var(--accent-cyan);animation:pulse 2s ease-in-out infinite}
    .nav-links{display:flex;gap:12px;align-items:center}
    .nav-link{padding:8px 18px;border-radius:12px;background:rgba(0,217,255,.08);border:1px solid var(--border-accent);color:var(--text-primary);text-decoration:none;font-weight:600;font-size:14px;transition:.3s}
    .nav-link.active{background:rgba(0,217,255,.2);border-color:var(--accent-cyan)}
    .nav-link:hover{background:rgba(0,217,255,.15);border-color:var(--accent-cyan);transform:translateY(-2px)}

    .container{max-width:1200px;margin:0 auto;padding:32px 24px;flex:1}
    .page-header{margin-bottom:20px}
    .page-title{font-size:32px;font-weight:800;background:linear-gradient(135deg,var(--text-primary),var(--accent-cyan));-webkit-background-clip:text;background-clip:text;-webkit-text-fill-color:transparent}
    .page-sub{color:var(--text-secondary);margin-top:6px}

    .controls{display:flex;flex-wrap:wrap;gap:10px;align-items:center;margin:14px 0 16px}
    .input{background:rgba(0,217,255,.08);border:1px solid var(--border-accent);color:var(--text-primary);padding:10px 12px;border-radius:10px;outline:none;min-width:280px}
    .select{background:rgba(0,217,255,.08);border:1px solid var(--border-accent);color:var(--text-primary);padding:10px 12px;border-radius:10px;outline:none}

    .card{background:linear-gradient(135deg,var(--bg-card),var(--bg-secondary));border:1px solid var(--border-color);border-radius:16px;padding:24px;box-shadow:0 8px 24px rgba(0,0,0,.4)}
    table{width:100%;border-collapse:collapse}
    th{padding:16px;text-align:left;font-weight:700;font-size:13px;text-transform:uppercase;letter-spacing:.5px;color:var(--accent-cyan);background:var(--bg-secondary);border-bottom:2px solid var(--border-color)}
    td{padding:16px;border-bottom:1px solid var(--border-color);color:var(--text-primary)}
    tbody tr{transition:background .2s ease}
    tbody tr:hover{background:var(--bg-hover)}
    tr.clickable-row{cursor:pointer}
    tbody tr:last-child td{border-bottom:none}

    .pager{display:flex;gap:10px;align-items:center;justify-content:flex-end;margin-top:14px;flex-wrap:wrap}
    .btn-page{padding:8px 12px;border-radius:10px;border:1px solid var(--border-accent);background:rgba(0,217,255,.08);color:var(--text-primary);text-decoration:none;font-weight:600;font-size:13px;cursor:pointer}
    .btn-page:hover{background:rgba(0,217,255,.15)}
    .btn-page[disabled]{opacity:.45;pointer-events:none}
    .page-indicator{color:var(--text-secondary);font-size:14px}

    .footer{margin-top:auto;padding:24px;text-align:center;color:var(--text-muted);font-size:14px;border-top:1px solid var(--border-color)}

    @keyframes pulse{0%,100%{transform:scale(.9);opacity:.8}50%{transform:scale(1);opacity:1}}

    @media (max-width:768px){
      .topbar-inner{flex-direction:column;gap:16px}
      .page-title{font-size:24px}
      th,td{padding:12px 8px;font-size:13px}
      .controls,.pager{justify-content:center}
    }
  </style>
</head>
<body>
<div class="page-wrapper">
  <header class="topbar">
    <div class="topbar-inner">
      <a href="/" class="brand"><span class="brand-dot"></span>Human Resource Management System</a>
      <nav class="nav-links">
        <a href="/" class="nav-link">Home</a>
        <a href="/akhila/departments" class="nav-link active">Departments</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="page-header">
      <h1 class="page-title">Departments</h1>
      <p class="page-sub">Pick a department to view its employees.</p>
    </div>

    <!-- Search + page size -->
    <div class="controls">
      <input id="search" class="input" type="text" placeholder="Search by Dept ID / Name / Manager ID …" />
      <label>
        <span style="color:var(--text-secondary);margin-right:6px;">Rows / page</span>
        <select id="pageSize" class="select">
          <option>5</option>
          <option selected>10</option>
          <option>20</option>
          <option>50</option>
        </select>
      </label>
    </div>

    <div class="card">
      <table id="deptTable">
        <thead>
          <tr>
            <th>Dept ID</th>
            <th>Department Name</th>
            <th>Manager ID</th>
          </tr>
        </thead>
        <tbody id="deptBody">
          <!-- Row: clickable, navigates with deptId + deptName -->
          <tr class="clickable-row"
              th:each="d : ${departments}"
              th:attr="data-href=@{|/akhila/employees?deptId=${d.departmentId}&deptName=${d.departmentName}|}">
            <td th:text="${d.departmentId}" style="font-weight:700;color:var(--accent-cyan)">10</td>
            <td th:text="${d.departmentName}" style="font-weight:600">Administration</td>
            <td th:text="${d.managerId != null ? d.managerId : '—'}">—</td>
          </tr>

          <!-- Server-side empty fallback -->
          <tr id="noDataServer" th:if="${#lists.isEmpty(departments)}">
            <td colspan="3" style="color: var(--text-muted); text-align: center;">No departments found.</td>
          </tr>
        </tbody>
      </table>

      <!-- Client-side "no matches" for search/paging -->
      <div id="noDataClient" style="display:none;color:var(--text-secondary);text-align:center;padding:14px 6px;">
        No matching departments.
      </div>

      <!-- Pager -->
      <div class="pager">
        <span class="page-indicator" id="pageInfo">Page 1 / 1</span>
        <span style="flex:1"></span>
        <button class="btn-page" id="prevBtn">Prev</button>
        <button class="btn-page" id="nextBtn">Next</button>
      </div>
    </div>

    <div th:if="${error}" style="margin-top:12px;color:#fca5a5" th:text="${error}"></div>
  </main>

  <footer class="footer">© 2025 Human Resource Management System • Enterprise Edition</footer>
</div>

<script>
  (function(){
    const tbody = document.getElementById('deptBody');
    const rows  = Array.from(tbody.querySelectorAll('tr.clickable-row'));
    const searchInput = document.getElementById('search');
    const pageSizeSel = document.getElementById('pageSize');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const pageInfo = document.getElementById('pageInfo');
    const noDataClient = document.getElementById('noDataClient');
    const noDataServer = document.getElementById('noDataServer');

    // Clickable rows -> navigate to /akhila/employees?deptId=...&deptName=...
    tbody.addEventListener('click', (e) => {
      const tr = e.target.closest('tr.clickable-row');
      if (!tr) return;
      const href = tr.getAttribute('data-href');
      if (href) window.location.href = href;
    });

    let filtered = rows.slice();
    let currentPage = 1;

    function applyFilter(){
      const q = (searchInput.value || '').trim().toLowerCase();
      filtered = rows.filter(tr => {
        const tds = tr.querySelectorAll('td');
        const text = Array.from(tds).map(td => (td.textContent || '').toLowerCase()).join(' | ');
        return !q || text.includes(q);
      });
      currentPage = 1;
      render();
    }

    function getPageSize(){
      const n = parseInt(pageSizeSel.value, 10);
      return Number.isFinite(n) && n > 0 ? n : 10;
    }

    function render(){
      // Hide all data rows
      rows.forEach(r => r.style.display = 'none');

      // Hide server "no data"; we control empty state client-side too
      if (noDataServer) noDataServer.style.display = 'none';

      // Empty after filter?
      if (filtered.length === 0){
        noDataClient.style.display = 'block';
        pageInfo.textContent = 'Page 0 / 0';
        prevBtn.disabled = true;
        nextBtn.disabled = true;
        return;
      } else {
        noDataClient.style.display = 'none';
      }

      const size = getPageSize();
      const totalPages = Math.max(1, Math.ceil(filtered.length / size));
      if (currentPage > totalPages) currentPage = totalPages;

      const start = (currentPage - 1) * size;
      const end   = Math.min(start + size, filtered.length);

      for (let i = start; i < end; i++){
        filtered[i].style.display = '';
      }

      pageInfo.textContent = `Page ${currentPage} / ${totalPages}`;
      prevBtn.disabled = currentPage <= 1;
      nextBtn.disabled = currentPage >= totalPages;
    }

    // Events
    searchInput.addEventListener('input', applyFilter);
    pageSizeSel.addEventListener('change', () => { currentPage = 1; render(); });
    prevBtn.addEventListener('click', () => { currentPage--; render(); });
    nextBtn.addEventListener('click', () => { currentPage++; render(); });
    searchInput.addEventListener('keydown', (e) => { if (e.key === 'Enter') e.preventDefault(); });

    // Initial paint
    render();
  })();
</script>
</body>
</html>